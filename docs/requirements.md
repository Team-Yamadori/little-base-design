# きょうのグラウンド - 要件定義書

> 少年野球向けスコアブックアプリケーション

---

## 1. プロダクト概要

### 1.1 目的

少年野球の試合をリアルタイムでスコア記録し、試合結果・個人成績を管理するモバイルWebアプリケーション。

### 1.2 対象ユーザー

- 少年野球チームの監督・コーチ・スコアラー
- 保護者

### 1.3 動作環境

- モバイルブラウザ（スマートフォン想定、max-width: 448px）
- Next.js / React / Tailwind CSS

---

## 2. 画面一覧と遷移

### 2.1 画面一覧

| # | 画面名 | 画面ID | 概要 |
|---|---|---|---|
| 1 | ログイン | `login` | LINE認証でのログイン |
| 2 | チーム選択 | `team-select` | チーム作成 or チーム参加 |
| 3 | チーム作成 | `team-create` | 2ステップのチーム新規作成ウィザード |
| 4 | ホーム | `home` | メインメニュー、試合開始 |
| 5 | チーム編集 | `team-edit` | チーム名・カラー変更 |
| 6 | 選手一覧 | `roster` | 選手の追加・編集・削除 |
| 7 | オーダー・守備設定 | `lineup` | 打順・守備位置の設定 |
| 8 | 試合設定 | `game-setup` | 先攻/後攻・イニング数の設定 |
| 9 | 試合（スコア入力） | `game` | リアルタイムのプレー記録 |
| 10 | 試合結果一覧 | `score-history` | 過去の試合一覧 |
| 11 | 試合詳細 | `game-detail` | 試合ごとのスコア・個人成績 |
| 12 | マイページ | `mypage` | プロフィール・各種メニュー |

### 2.2 画面遷移図

```
login
  → team-select（チーム未作成の場合）
      → team-create（チーム作成）
      → home（チーム参加）
  → home（チーム作成済みの場合）

home
  → game-setup → lineup → game → （試合終了後）score-history
  → game（進行中の試合を再開）

[ボトムタブ]（ログイン＋チーム作成後に表示）
  ホーム ↔ 試合結果 ↔ マイページ

mypage → roster / team-edit / score-history
score-history → game-detail
```

### 2.3 ボトムタブ

| タブ | 遷移先 | アイコン |
|---|---|---|
| ホーム | `home` | Home |
| 試合 | `score-history` | Trophy |
| マイページ | `mypage` | User |

**表示条件**: ログイン済み かつ チーム作成済み
**非表示画面**: login, team-select, team-create, game, game-setup, team-edit, game-detail, lineup

---

## 3. 画面別要件

### 3.1 ログイン画面

**表示要素:**
- アプリロゴ・アプリ名「KYONO GROUND」
- サブタイトル「スコアブック」
- キャッチコピー「チームの試合をスコアブックで記録しよう」
- LINEログインボタン（LINE公式カラー）

**操作:**
- LINEログインボタン押下 → ゲストとしてログイン（`userName = "ゲスト"`）
- チーム作成済み → ホーム画面へ遷移
- チーム未作成 → チーム選択画面へ遷移

---

### 3.2 チーム選択画面

**表示要素:**
- 「チームを作成」ボタン
- 「チームに参加」ボタン（展開式）
  - チームコード入力欄（最大8文字、自動大文字変換）
  - 「参加する」ボタン

**バリデーション:**
- チームコード: 1文字以上で「参加する」ボタン有効化

**操作:**
- 「チームを作成」→ チーム作成画面へ
- チームコード入力 →「参加する」→ ホーム画面へ

---

### 3.3 チーム作成画面

**STEP 1: チーム名入力**
- プログレスバー（50%）
- チーム名テキスト入力（最大20文字）
- 文字数カウンター表示
- 「次へ」ボタン（未入力時は無効）

**STEP 2: チームカラー選択**
- プログレスバー（100%）
- チームプレビュー（カラー + 頭文字バッジ）
- 8色カラーパレット:
  - レッド `hsl(0,85%,55%)`
  - ブルー `hsl(210,80%,50%)`
  - グリーン `hsl(145,70%,42%)`
  - オレンジ `hsl(25,95%,55%)`
  - パープル `hsl(270,65%,55%)`
  - イエロー `hsl(45,95%,52%)`
  - ピンク `hsl(330,75%,55%)`
  - ネイビー `hsl(220,60%,35%)`
- 「戻る」/「チームを作成」ボタン

**バリデーション:**
- チーム名: 1〜20文字
- カラー: 8色から1つ必須

**完了後:** `teamCreated = true`、ホーム画面へ遷移

---

### 3.4 ホーム画面

**表示要素:**
- アプリヘッダー
- 進行中試合カード（存在する場合のみ表示）
  - LIVEバッジ（赤パルスアニメーション）
  - イニング表示（TOP/BOTTOM + 回数）
  - スコア表示（アウェイ vs ホーム）
  - ミニカウント表示（B, S, O, 塁状態）
- マイチームカード
  - チームバッジ（カラー + 略称）
  - チーム名 + 選手数
  - スタメン上位4名の打順・守備・氏名
- 「新しい試合を始める」ボタン
- バージョン表示（v5.0）

**操作:**
- 進行中試合カード押下 → 試合画面へ（再開）
- 「新しい試合を始める」→ 対戦相手をランダム生成 → 試合設定画面へ

---

### 3.5 チーム編集画面

**表示要素:**
- チームプレビューバッジ
- チーム名入力（最大12文字）
- 略称入力（最大2文字）
- 8色カラーパレット（選択中にチェックマーク）
- 「保存する」ボタン

**バリデーション:**
- チーム名: 最大12文字
- 略称: 最大2文字（自動切り詰め）

---

### 3.6 選手一覧画面

**一覧表示:**
- ヘッダー: 「選手一覧 - {チーム名}」
- カラムヘッダー: 背番 / 守 / 選手名
- 選手リスト（スクロール可能）
- 「選手を追加」ボタン

**選手詳細モーダル:**
- 選手アイコン + 背番号 + 名前 + ポジション
- 編集フィールド:
  - 名前（テキスト入力）
  - 背番号（0〜99のドロップダウン）
- 成績表示:
  - 野手: 打率, HR, 打点, 安打, 打数, 得点, 盗塁, 四球, 三振, 二塁打, 出塁率, 長打率
  - 投手: ERA, 勝, 敗, S, H, 登板, 奪三振, 与四球, 投球回, 被安打, WHIP, 完封
- 「選手を削除」ボタン + 確認ダイアログ

**バリデーション:**
- スタメン9人に含まれる選手は削除不可
- 背番号: 0〜99
- 新規追加時は背番号を自動採番

---

### 3.7 オーダー・守備設定画面

**表示要素:**
- ヒントバー:
  - 通常時: 「長押しで選手を移動」
  - ドラッグ中: 「入れ替える位置で指を離す」
- スタメン枠（左側、9枠）: 打順 / 背番号 / 選手名 / 守備位置
- ベンチ枠（右側）: 名前 + ポジション
- 「プレイボール！」ボタン

**操作:**
- 長押し（300ms）→ ドラッグ開始
- ドラッグ先にドロップ → 選手入れ替え
  - スタメン内: 打順入れ替え
  - スタメン↔ベンチ: 選手交換
- ドラッグ中の選手は半透明コピーで表示
- ドロップ先はダッシュ枠線でハイライト

**制約:**
- スタメンは常に9人

---

### 3.8 試合設定画面

**表示要素:**
- 対戦カード（マイチーム VS 対戦相手）
- 攻守選択: 先攻 / 後攻（デフォルト: 先攻）
- イニング数選択: 7 / 9 / 12（デフォルト: 9）
- 「オーダー設定へ」ボタン

**保存データ:**
- `isTopOfInning`: 先攻=true, 後攻=false
- `totalInnings`: 7 / 9 / 12

---

### 3.9 試合画面（スコア入力）

#### 3.9.1 画面構成

**上部バー:**
- 戻るボタン（メニューへ）
- 「戻る」ボタン（undo、履歴がない時は無効）
- 「タイム」ボタン（選手交代メニュー）

**スコアHUD:**
- イニング表示（TOP/BOTTOM + 回数）
- 両チーム名 + スコア
- ベースダイアモンド（小）

**中段表示:**
- カウント表示（B / S / O）
- 打者情報（名前, 背番号, ポジション, 打率）
- 投手情報（名前, 背番号, ポジション, 防御率）
- イニングボード（回ごとの得点テーブル）
- ベースダイアモンド（大）

**操作タブ（5タブ）:**

| タブ | ボタン |
|---|---|
| 投球 | ボール / ストライク / ファウル |
| 安打 | シングル / 二塁打 / 三塁打 / ホームラン |
| アウト | ゴロ / フライ / ライナー / 犠飛 / 犠打 |
| 走塁 | 盗塁成功 / 盗塁失敗 / 暴投 / 捕逸 / ボーク / 走塁アウト |
| その他 | 死球 / 振り逃げ / 野選 / エラー / 打撃妨害 / 走塁妨害 / 守備妨害 |

#### 3.9.2 モーダル画面

**三振種別選択:**
- 表示条件: 2ストライクでストライク押下
- 選択肢: 空振り三振 / 見逃し三振

**打球方向選択:**
- 表示条件: 安打系ボタン押下後
- 選択肢: 投 / 捕 / 一 / 二 / 三 / 遊 / 左 / 中 / 右

**守備番号選択:**
- 表示条件: アウト系ボタン押下後
- 入力: 守備番号1〜9を順番にタップ
- 同じ番号2回タップ: 同選手が2回関与（例: 6→6→3）
- 同じ番号3回タップ: リセット
- 「完了」で確定

**走者選択画面:**
- 表示条件: 走者の行き先を手動指定する必要がある時
- 各走者ごとに行き先ボタンを表示
  - 表示順: 打者 → 1塁走者 → 2塁走者 → 3塁走者
  - 選択肢の表示順: 残留 → 1塁 → 2塁 → 3塁 → 得点 → OUT
- 選択中の行き先にはリング枠を表示
- `requiresOut = true` のプレーでは、アウトが未選択だと「確定」ボタン無効
- 「キャンセル」/「確定」ボタン

**選手交代メニュー（タイムボタン）:**
- 代打: 打者をベンチ選手と交換
- 代走: 走者をベンチ選手と交換（走者がいない時は無効）
- 守備交代: スタメンとベンチの選手を交換

**試合終了画面:**
- 「GAME SET」オーバーレイ
- 最終スコア表示
- 「もう一度」/「結果を保存」ボタン

#### 3.9.3 Undo機能

- 「← 戻る」ボタン押下 → 確認ダイアログ表示
- ダイアログに直前の操作ラベルを表示（例: 「ゴロ 5→3 の操作が消えます」）
- 「はい」→ 直前のGameStateとbatterIndexを復元
- 複数回実行可能（履歴スタック）

---

### 3.10 試合結果一覧画面

**空の場合:**
- トロフィーアイコン
- 「まだ試合結果がありません」メッセージ
- 「試合を始める」ボタン

**試合がある場合:**
- 各試合カード（新しい順）
  - 日付 + 「詳細」リンク
  - 両チームバッジ + スコア
  - 勝利チームに青ハイライト
  - イニングスコアテーブル（R / H / E 含む）

**操作:**
- 試合カード押下 → 試合詳細画面へ

---

### 3.11 試合詳細画面

**ヘッダー:** 「試合詳細」+ 日付

**スコア表示:**
- 両チームバッジ + 大きなスコア
- 勝利チームに「WIN」バッジ

**タブ:**
1. **スコア**: イニング別得点テーブル（横スクロール対応）+ R / H / E
2. **打撃成績**: チームごとにテーブル表示
   - カラム: 打順 / 守備 / 選手名 / 打数 / 安打 / 打点 / 打率
3. **投手成績**: チームごとにテーブル表示
   - カラム: 投手名 / 結果(W/L) / 投球回 / 被安打 / 自責点 / 奪三振 / 四球

---

### 3.12 マイページ画面

**表示要素:**
- プロフィールカード（ユーザー名, チーム名, 勝敗引分）
- メニュー:
  - 選手一覧（{n}人登録中）
  - チーム編集
  - 試合履歴（{n}試合）
- ログアウトボタン

**操作:**
- 各メニュー → 対応画面へ遷移
- ログアウト → ログイン画面へ（`isLoggedIn = false`）

---

## 4. ゲームロジック要件

### 4.1 投球カウント

| 条件 | 動作 |
|---|---|
| ボール押下（balls < 3） | balls + 1 |
| ボール押下（balls = 3） | 四球確定。強制進塁処理 → カウントリセット → 次の打者 |
| ストライク押下（strikes < 2） | strikes + 1 |
| ストライク押下（strikes = 2） | 三振種別選択画面を表示 |
| ファウル押下（strikes < 2） | strikes + 1 |
| ファウル押下（strikes = 2） | カウント変化なし（メッセージ表示のみ） |

### 4.2 三振確定

- 空振り三振 / 見逃し三振を選択
- outs + 1
- カウントリセット → 次の打者
- 3アウトならチェンジ

### 4.3 安打処理

**ホームラン:**
- 打球方向選択 → 即時確定
- 全走者 + 打者がホームイン
- 得点 = 塁上走者数 + 1
- 塁をクリア → カウントリセット → 次の打者

**三塁打:**
- 打球方向選択 → 即時確定
- 全走者がホームイン、打者は3塁
- 得点 = 塁上走者数
- bases = [false, false, true] → カウントリセット → 次の打者

**シングル / 二塁打:**
- 打球方向選択 → 走者選択画面（選択肢が1つしかない場合はスキップ）
- 走者の行き先をユーザーが指定

### 4.4 強制進塁（四球・死球・敬遠共通）

打者が1塁に進塁し、1塁から順に走者を押し出す。押し出しの連鎖は1塁が占有されている場合のみ発生する。

| 走者状態 | 結果 | 得点 |
|---|---|---|
| 走者なし | 打者→1塁 | 0 |
| 1塁 | 打者→1塁, 1塁→2塁 | 0 |
| 2塁 | 打者→1塁（2塁走者は不動） | 0 |
| 3塁 | 打者→1塁（3塁走者は不動） | 0 |
| 1・2塁 | 打者→1塁, 1塁→2塁, 2塁→3塁 | 0 |
| 1・3塁 | 打者→1塁, 1塁→2塁（3塁走者は不動） | 0 |
| 2・3塁 | 打者→1塁（2塁・3塁走者は不動） | 0 |
| 満塁 | 打者→1塁, 1塁→2塁, 2塁→3塁, 3塁→本塁 | 1 |

### 4.5 走者選択画面の仕様

#### 表示条件
以下のプレーで走者の行き先を手動で指定する必要がある場合に表示:
- 安打（シングル・二塁打）で走者がいる場合
- アウト系（ゴロ・フライ・ライナー・犠飛・犠打）で走者がいる場合
- 走塁イベント（盗塁・暴投・捕逸等）
- その他（野選・エラー・振り逃げ等）

#### allSingle 判定
全スロットの選択肢が1つ以下の場合、走者選択画面を表示せずに即時確定する。
例: 走者なしのシングルヒット、ボーク

#### 衝突解消（カスケード）
走者が同じ塁に重ならないよう自動調整する。
- **前方カスケード**: 後ろの走者が前の走者と同じ or 先の塁にいる場合、前の走者を1つ先に押し出す
- **後方カスケード**: ユーザー操作時のみ。前の走者が後ろの走者と同じ or 手前の塁にいる場合、後ろの走者を1つ手前に戻す

#### バリデーション
- 同じ塁に複数走者は配置不可（home/out は除く）
- 全スロットの destination がその options に含まれること
- `requiresOut = true` のプレーでは最低1つのアウトが必要

### 4.6 プレー確定処理

走者選択画面で「確定」押下時:

1. 各スロットの destination を走査
   - `out` → アウトカウント + 1
   - `home` → 得点 + 1
   - `1B` / `2B` / `3B` → 該当塁を占有
2. 得点をチームスコアに加算（イニングスコア + 総得点）
3. `isHit = true` なら安打数 + 1（攻撃チーム）
4. `isError = true` なら失策数 + 1（守備チーム）
5. `preserveCount = true` の場合: カウント維持、打者変更なし
6. `preserveCount = false` の場合: カウントリセット、次の打者へ
7. アウトカウント >= 3 ならチェンジ処理

### 4.7 チェンジ処理（3アウト）

- カウント・アウト・走者をリセット
- 表 → 裏に切り替え（同イニング）
- 裏 → 次のイニングの表に切り替え
- 最終イニングの裏が終了 → 試合終了

### 4.8 試合終了条件

- 9イニング（設定値）の裏の3アウト完了時

### 4.9 preserveCount（カウント維持）

以下のプレーは打席の途中で発生するため、カウントをリセットせず打者も変更しない:
- 盗塁成功 / 盗塁失敗
- 暴投 / 捕逸 / ボーク
- 走塁アウト
- 走塁妨害 / 守備妨害

### 4.10 requiresOut（アウト必須）

以下のプレーは性質上、最低1人がアウトになる必要がある:
- ゴロ / フライ / ライナー / 犠飛 / 犠打
- 盗塁失敗 / 走塁アウト / 守備妨害

走者選択画面でアウトが未選択の場合、確定ボタンを無効化する。

---

## 5. 各プレータイプの走者選択肢

### 5.1 安打系

| プレー | isHit | 打者デフォルト | 打者選択肢 | 走者の進塁パターン |
|---|---|---|---|---|
| シングル | true | 1B | 1B | 走者は1〜2塁先まで進塁可能 |
| 二塁打 | true | 2B | 2B | 3塁走者は自動ホーム。他は3B/home |
| 三塁打 | true | - | - | 全走者自動ホーム。打者は3塁。即時確定 |
| ホームラン | true | - | - | 全員自動ホーム。即時確定 |

### 5.2 アウト系

| プレー | requiresOut | 打者デフォルト | 打者選択肢 | 走者の選択肢 |
|---|---|---|---|---|
| ゴロ | true | out | out, 1B, 2B, 3B, home | 残留〜home, out |
| フライ | true | out | out | 残留〜home, out |
| ライナー | true | out | out | 残留〜home, out |
| 犠飛 | true | out | out | 前方進塁 or 残留 |
| 犠打 | true | out | out, 1B, 2B | 1塁先に進塁 |

### 5.3 走塁系（preserveCount: true）

| プレー | requiresOut | 走者のデフォルト | 走者の選択肢 |
|---|---|---|---|
| 盗塁成功 | - | 1つ先の塁 | 進塁先 or 元の塁 |
| 盗塁失敗 | true | 1塁走者はout、他は元の塁 | out or 元の塁 |
| 暴投 | - | 1つ先の塁 | 進塁先 or 元の塁 |
| 捕逸 | - | 1つ先の塁 | 進塁先 or 元の塁 |
| ボーク | - | 1つ先の塁 | 1つ先の塁のみ（選択不可） |
| 走塁アウト | true | 元の塁 | out or 元の塁 |

### 5.4 その他

| プレー | 特記事項 | 打者 | 走者 |
|---|---|---|---|
| 野選 | 走者必須 | 1B固定 | out/進塁/残留 |
| エラー | isError=true | 1B〜3B | 進塁（home含む） |
| 振り逃げ | - | 1B or out | 進塁 or 残留 |
| 打撃妨害 | - | 1B固定 | 進塁 or 残留 |
| 走塁妨害 | preserveCount, 走者必須 | なし | 進塁 or 残留 |
| 守備妨害 | requiresOut, preserveCount, 走者必須 | なし | out or 残留 |

---

## 6. データモデル

### 6.1 Team（チーム）

| フィールド | 型 | 説明 |
|---|---|---|
| id | string | チームID |
| name | string | チーム名 |
| shortName | string | 略称（最大2文字） |
| color | string | メインカラー（HSL） |
| subColor | string | サブカラー（HSL） |
| players | Player[] | 全選手 |
| lineup | LineupSlot[9] | スタメン9人（打順順） |
| benchPlayers | string[] | ベンチ選手ID一覧 |
| pitchingRotation | string[] | 投手ローテーション |

### 6.2 Player（選手）

| フィールド | 型 | 説明 |
|---|---|---|
| id | string | 選手ID |
| name | string | 選手名 |
| number | number | 背番号（0〜99） |
| position | Position | メインポジション |
| subPositions? | Position[] | サブポジション |

**打撃成績:**

| フィールド | 説明 |
|---|---|
| avg | 打率 |
| hr | 本塁打 |
| rbi | 打点 |
| hits | 安打数 |
| atBats | 打数 |
| runs | 得点 |
| stolenBases | 盗塁 |
| obp | 出塁率 |
| slg | 長打率 |
| walks | 四球 |
| strikeoutsBatting | 三振 |
| doubles | 二塁打 |
| triples | 三塁打 |
| sacrificeBunts | 犠打 |
| sacrificeFlies | 犠飛 |

**投手成績（投手のみ）:**

| フィールド | 説明 |
|---|---|
| era | 防御率 |
| wins / losses | 勝 / 敗 |
| saves / holds | セーブ / ホールド |
| strikeouts | 奪三振 |
| pitchWalks | 与四球 |
| inningsPitched | 投球回 |
| hitsAllowed | 被安打 |
| earnedRuns | 自責点 |
| games | 登板数 |
| completeGames | 完投 |
| shutouts | 完封 |
| whip | WHIP |

### 6.3 LineupSlot（スタメン枠）

| フィールド | 型 | 説明 |
|---|---|---|
| playerId | string | 選手ID |
| fieldPosition | Position | 守備位置 |

### 6.4 GameState（試合中の状態）

| フィールド | 型 | 説明 |
|---|---|---|
| home / away | TeamData | 各チームの試合データ |
| inning | number | 現在のイニング（1〜） |
| isTop | boolean | 表=true, 裏=false |
| balls | number | ボールカウント（0〜3） |
| strikes | number | ストライクカウント（0〜2） |
| outs | number | アウトカウント（0〜2） |
| bases | [boolean, boolean, boolean] | 塁の占有状態 [1塁, 2塁, 3塁] |
| currentBatter | PlayerData | 現在の打者 |
| currentPitcher | PlayerData | 現在の投手 |
| isPlaying | boolean | 試合進行中 |
| isGameOver | boolean | 試合終了 |

### 6.5 TeamData（試合中のチームデータ）

| フィールド | 型 | 説明 |
|---|---|---|
| name | string | チーム名 |
| shortName | string | 略称 |
| scores | (number \| null)[] | イニング別得点（null=未プレー） |
| runs | number | 総得点 |
| hits | number | 総安打数 |
| errors | number | 総失策数 |
| color | string | チームカラー |

### 6.6 GameRecord（試合記録）

| フィールド | 型 | 説明 |
|---|---|---|
| id | string | 試合ID |
| date | string | 日付 |
| homeTeam / awayTeam | string | チーム名 |
| homeShort / awayShort | string | 略称 |
| homeColor / awayColor | string | カラー |
| homeScore / awayScore | number | 最終スコア |
| innings | { away: number[], home: number[] } | イニング別得点 |
| homeHits / awayHits | number | 安打数 |
| homeErrors / awayErrors | number | 失策数 |
| homeLineup / awayLineup | 打撃成績[] | 選手別打撃成績 |
| homePitchers / awayPitchers | 投手成績[] | 投手別成績 |

### 6.7 Position（守備位置）

```
投手 / 捕手 / 一塁 / 二塁 / 三塁 / 遊撃 / 左翼 / 中堅 / 右翼 / DH
```

守備番号対応: 投手=1, 捕手=2, 一塁=3, 二塁=4, 三塁=5, 遊撃=6, 左翼=7, 中堅=8, 右翼=9

---

## 7. アプリ状態管理

### 7.1 AppState（グローバル状態）

| フィールド | 型 | 説明 |
|---|---|---|
| myTeam | Team | 自チーム |
| opponent | Team | 対戦相手 |
| gameRecords | GameRecord[] | 試合記録一覧 |
| playerGameStats | PlayerGameStats[] | 選手別試合成績 |
| currentScreen | Screen | 現在の画面 |
| gameConfig | GameConfig | 試合設定 |
| activeGameState | GameState \| null | 進行中試合の状態 |
| isLoggedIn | boolean | ログイン状態 |
| userName | string | ユーザー名 |
| teamCreated | boolean | チーム作成済みフラグ |

### 7.2 GameConfig（試合設定）

| フィールド | 型 | 説明 |
|---|---|---|
| isTopOfInning | boolean | true=先攻, false=後攻 |
| totalInnings | number | イニング数（7/9/12） |

---

## 8. 自動判定ルール

| イベント | トリガー | 動作 |
|---|---|---|
| 四球 | balls が 4 に到達 | 打者→1塁、走者を強制進塁 |
| 三振 | strikes が 3 に到達 | 三振種別選択後にアウト + 1 |
| ファウル（2S後） | 2ストライクでファウル | カウント変化なし |
| 得点 | 走者がホームを選択 or 押し出し | チーム得点 + 1、イニングスコア + 1 |
| チェンジ | アウトが 3 に到達 | 攻守交代、カウント・塁・アウトをリセット |
| イニング進行 | 裏の3アウト完了 | 次のイニングの表へ |
| 試合終了 | 最終イニングの裏が完了 | isGameOver = true |
| 打順進行 | 打席結果確定（preserveCount以外） | 次の打者を表示 |

---

## 9. 選手交代

### 9.1 代打

- 現在の打者をベンチ選手と交換
- 打順はそのまま引き継ぐ

### 9.2 代走

- 塁上の走者をベンチ選手と交換
- 走者がいない場合は選択不可

### 9.3 守備交代

- スタメンとベンチの選手を入れ替え
- ドラッグ&ドロップで操作

---

## 10. メッセージ仕様

表示時間: 1.8秒で自動消去

| 条件 | メッセージ |
|---|---|
| 四球 | "フォアボール!" |
| 死球 | "死球!" |
| 敬遠 | "敬遠!" |
| ファウル（2S後） | "ファウル!" |
| 空振り三振 | "空振り三振!" |
| 見逃し三振 | "見逃し三振!" |
| ソロホームラン | "ソロホームラン!" |
| 2ラン以上 | "{n}ランHR!" |
| 満塁ホームラン | "満塁ホームラン!!" |
| 三塁打 | "三塁打!" |
| 1点 | "得点!" |
| 2点以上 | "{n}点!" |
| 得点なし | "{プレー名}!" |
| 3アウト | "チェンジ!" |
| 試合終了 | "試合終了!" |
| リセット | "リセット!" |
| 走者不在 | "走者がいません" |
| 3塁走者不在（犠飛時） | "3塁走者がいません" |

---

## 11. 非機能要件

### 11.1 レスポンシブ

- モバイルファースト（max-width: 448px）
- タッチ操作最適化（active:scale-95 フィードバック）
- 長押し操作のサポート（300ms閾値）

### 11.2 状態永続化

- 現状: メモリ内のみ（リロードでリセット）
- 試合中の状態は `activeGameState` として保持
- 試合終了時に `GameRecord` として保存

### 11.3 Undo

- 操作履歴をスタックで管理
- 任意の回数巻き戻し可能
- 確認ダイアログで操作内容を表示

### 11.4 アニメーション

- スライドアップ: 走者選択画面（0.25s ease-out）
- パルス: LIVEバッジ
- スケール: ボタン押下時（active:scale-95）
- フェード: メッセージ表示/消去
